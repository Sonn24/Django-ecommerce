{% extends "base.html" %}
{% load humanize %}

{% block order_summary %}
<main class="py-5">
  <div class="container">

    <div class="table-responsive shadow-sm p-4 bg-white rounded">
      <h2 class="mb-4">üõí Order Summary</h2>

      {% if object.items.exists %}
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Item</th>
            <th scope="col">Size</th>
            <th scope="col">Color</th>
            <th scope="col">Price</th>
            <th scope="col" class="text-center">Quantity</th>
            <th scope="col">Total</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          {% for order_item in object.items.all %}
          <tr>
            <th scope="row">{{ forloop.counter }}</th>
            <td>{{ order_item.item.title }}</td>
            <td>{{ order_item.size|default:"-" }}</td>
            <td>{{ order_item.color|default:"-" }}</td>
            <td>Ksh {{ order_item.price|intcomma }}</td>
            <td class="text-center">
              <a href="{% url 'core:remove-single-item-from-cart' order_item.item.slug %}?size={{ order_item.size }}&color={{ order_item.color }}"
                class="text-danger me-2">
                <i class="fas fa-minus"></i>
              </a>
              <span class="fw-bold">{{ order_item.quantity }}</span>
              <a href="{% url 'core:add-to-cart' order_item.item.slug %}?size={{ order_item.size }}&color={{ order_item.color }}"
                class="text-success ms-2">
                <i class="fas fa-plus"></i>
              </a>
            </td>
            <td>Ksh {{ order_item.get_final_price|intcomma }}</td>
            <td>
              <a href="{% url 'core:remove-from-cart' order_item.item.slug %}?size={{ order_item.size }}&color={{ order_item.color }}"
                class="text-danger">
                <i class="fas fa-trash"></i>
              </a>
            </td>
          </tr>
          {% endfor %}

          {% if object.coupon %}
          <tr>
            <td colspan="6"><b>Coupon</b></td>
            <td colspan="2"><b>- Ksh {{ object.coupon.amount|intcomma }}</b></td>
          </tr>
          {% endif %}

          <tr class="table-light">
            <td colspan="6"><b>Order Total</b></td>
            <td colspan="2"><b>Ksh {{ object.get_total|intcomma }}</b></td>
          </tr>

          <tr>
            <td colspan="8" class="text-end">
              <a href="{% url 'core:shop' %}" class="btn btn-outline-primary">Continue Shopping</a>
              <a href="/pay/" class="btn btn-warning ms-2">Proceed to Payment</a>
            </td>
          </tr>
        </tbody>
      </table>

      {% else %}
      <div class="text-center py-5">
        <h3 class="mb-3">üóëÔ∏è Your cart is empty</h3>
        <p class="text-muted">Looks like you have no items in your cart.</p>
        <a href="{% url 'core:shop' %}" class="btn btn-dark mt-3">
          Continue Shopping
        </a>
      </div>
      {% endif %}

      </tbody>
      </table>
    </div>

  </div>
</main>
{% endblock order_summary %}